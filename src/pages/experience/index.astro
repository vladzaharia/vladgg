---
import PageLayout from "../../layouts/PageLayout.astro";
import Heading from "../../components/text/Heading.astro";
import Timeline from "../../components/timeline/Timeline.astro";
import { createReader } from '@keystatic/core/reader';
import keystaticConfig from '../../../keystatic.config';

const reader = createReader(process.cwd(), keystaticConfig);
const jobs = await reader.collections.jobs.all();

// Sort jobs by date, most recent first
jobs.sort((a, b) => {
  const dateA = new Date(a.entry.dateFrom ?? 0);
  const dateB = new Date(b.entry.dateFrom ?? 0);
  return dateB.getTime() - dateA.getTime();
});

// Format date helper
const formatDate = (date: string) => {
  if (!date) return 'Present';
  return new Date(date).toLocaleDateString('en-US', { 
    month: 'long',
    year: 'numeric'
  });
};
---

<PageLayout title="Experience">
  <main class="container mx-auto p-6">
    <Heading class="mb-8">Experience</Heading>
    <div class="max-w-6xl mx-auto">
      <Timeline jobs={jobs} />
    </div>
  </main>
</PageLayout>