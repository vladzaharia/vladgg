---
import PageLayout from '../../layouts/PageLayout.astro';
import { createReader } from '@keystatic/core/reader';
import keystaticConfig from '../../../keystatic.config';

const { slug } = Astro.params;
const reader = createReader(process.cwd(), keystaticConfig);

const job = await reader.collections.jobs.readOrThrow(slug!);
const content = await job.content();

if (!job) {
  return Astro.redirect('/404');
}

// Format date range
const formatDate = (date: string) => {
  if (!date) return 'Present';
  return new Date(date).toLocaleDateString('en-US', {
    month: 'long',
    year: 'numeric',
  });
};

const dateRange = `${formatDate(job.dateFrom)} - ${job.dateTo ? formatDate(job.dateTo) : 'Present'}`;
---

<PageLayout title={`${job.position} at ${job.company.name}`}>
  <main class="container mx-auto p-6">
    <div class="max-w-4xl mx-auto">
      <div class="flex flex-col gap-6">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
          <div>
            <h1 class="text-4xl font-bold font-display mb-2">{job.position}</h1>
            <div class="text-xl text-slate-300">
              {
                job.company.logo && (
                  <img
                    src={job.company.logo}
                    alt={job.company.name}
                    class="h-6 w-auto inline-block mr-2"
                  />
                )
              }
              <a
                href={job.company.url}
                target="_blank"
                rel="noopener noreferrer"
                class="hover:text-white transition-colors"
              >
                {job.company.name}
              </a>
            </div>
          </div>

          <div class="flex flex-col items-end gap-1">
            <div class="text-lg text-slate-300">{job.location}</div>
            <div class="text-lg text-slate-400">{dateRange}</div>
          </div>
        </div>

        <div class="prose prose-invert max-w-none">
          {content}
        </div>
      </div>
    </div>
  </main>
</PageLayout>
